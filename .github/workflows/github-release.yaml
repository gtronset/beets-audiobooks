# https://docs.github.com/en/actions

name: "Release"

on:
  workflow_dispatch:

jobs:
  release:
    name: "Release"

    runs-on: "ubuntu-latest"

    steps:
      #- name: "Determine tag"
      #  run: "echo \"RELEASE_TAG=${GITHUB_REF#refs/tags/}\" >> $GITHUB_ENV"
      - uses: actions/checkout@v3


      - name: Get repo variables
        id: get_repo_vars
        uses: mikefarah/yq@master
        with:
          cmd: yq -o "json" '.' ./repo-vars.yaml

      - name: "Create release"
        uses: "actions/github-script@v6.3.3"
        env:
          PROJECT_VERSION: ${{ fromJSON(steps.get_repo_vars.outputs.result).project_version }}
          LSIO_VERSION: ${{ fromJSON(steps.get_repo_vars.outputs.result).lsio_version }}
          BA_VERSION: ${{ fromJSON(steps.get_repo_vars.outputs.result).ba_version }}
        with:
          script: |
            const script = require('./.github/workflows/github-release/github-release.js')
            await script({github, context, core})
